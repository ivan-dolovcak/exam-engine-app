<?php
require_once "config.php";
session_start();
?>
<!DOCTYPE html>
<html>
<head>
    <?php include "head.phtml"; ?>
    <title><?=LANG["profile"]?> &bull; Exam Engine</title>

    <script>
    window.addEventListener("DOMContentLoaded", () => {
        function updatePreferences(name, value)
        {
            location.href
                = `/app/api/update_preferences.php?name=${name}&value=${value}`;
        }

        for (const configDropdown of document.getElementsByClassName("config-dropdown")) {
            configDropdown.value = preferences[configDropdown.id];
            configDropdown.addEventListener("change",
                () => updatePreferences(configDropdown.id, configDropdown.value));
            }
        });
        </script>
</head>
<body>
<header>
    <?php include "header.phtml"; ?>
</header>
<main>
<section>
    <h1><?=LANG["profile"]?></h1>

<?php if (isset($_SESSION["userID"])): ?>
    <?php
        $user = UserModel::ctorLoad($_SESSION["userID"]);
        $fullName = $user->firstName . " " . $user->lastName;
    ?>

    <h3><?=$user->firstName?> <?=$user->lastName?> (@<?=$user->username?>)</h3>
    <ul>
        <li><?=LANG["lastLogin"]?> <span class="timestamp" data-format="datetime">
            <?=$user->lastLoginTime?></span></li>
        <li><?=LANG["joined"]?> <span class="timestamp" data-format="date">
            <?=$user->creationDate?></span></li>
    </ul>

    <a class="btn" href="/app/forms/log_out.php">
        <i class="bi bi-escape"></i> <?=LANG["logOut"]?></a>
<?php else: ?>
    <p>
        <a href="http://localhost/views/log_in.phtml"><?=LANG["logInCTA1"]?></a>
        <?=LANG["logInCTA2"]?>
    </p>
<?php endif; ?>
</section>
<section>
    <h1><?=LANG["preferences"]?></h1>
    <ul>
        <li>
            <?=LANG["theme"]?>:
            <select id="theme" class="input config-dropdown">
                <option value="dark"><?=LANG["dark"]?></option>
                <option value="light"><?=LANG["light"]?></option>
            </select>
        </li>
        <li>
            <?=LANG["lang"]?>:
            <select id="lang" class="input config-dropdown">
                <option value="hr"><?=LANG["hr"]?></option>
                <option value="en"><?=LANG["en"]?></option>
            </select>
        </li>
    </ul>

    <a class="btn" href="/app/api/update_preferences.php?name=reset">
        <i class="bi bi-x-circle"></i> <?=LANG["resetPreferences"]?></a>
</section>
</main>
<footer>
    <?php include "footer.phtml"; ?>
</footer>
</body>
</html>
